<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Nancy Drew English Trainer</title>
    <style>
        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #7a1a1a; /* reddish background */
            color: #fff;
            overflow-x: hidden;
        }

        h1 {
            text-align: center;
            margin: 20px 10px 8px;
            text-shadow: 0 0 10px rgba(0,0,0,0.6);
        }

        h2 {
            text-align: center;
            margin-top: 0;
        }

        .section {
            max-width: 960px;
            margin: 16px auto 24px;
            background: rgba(60, 10, 10, 0.95);
            border-radius: 18px;
            padding: 18px 22px 22px;
            box-shadow: 0 10px 24px rgba(0,0,0,0.45);
            border: 1px solid rgba(255,255,255,0.25);
        }

        .flashcard {
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 16px 18px;
            margin-top: 10px;
            background: rgba(255,255,255,0.06);
        }

        .flash-main {
            font-size: 30px;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .flash-extra {
            margin-bottom: 4px;
            font-size: 15px;
            color: #e0e7ff;
        }

        .controls {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        button {
            cursor: pointer;
            padding: 8px 14px;
            border-radius: 999px;
            border: none;
            font-size: 14px;
            font-weight: 600;
            color: #1b243b;
            background: #ffd54f;
            box-shadow: 0 3px 0 #c7a235;
            transition: transform 0.05s ease, box-shadow 0.05s ease, background 0.15s ease;
        }

        button:hover {
            background: #ffe082;
        }

        button:active {
            transform: translateY(2px);
            box-shadow: 0 1px 0 #c7a235;
        }

        .quiz-block {
            margin-top: 10px;
        }

        .quiz-question {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .quiz-sub {
            font-size: 13px;
            color: #c8d8ff;
            margin-bottom: 6px;
        }

        .quiz-result {
            margin-top: 8px;
            min-height: 22px;
            font-size: 15px;
        }

        .correct {
            color: #c5ff90;
        }

        .incorrect {
            color: #ffb0b0;
        }

        .small-note {
            font-size: 12px;
            color: #c8d8ff;
            margin-top: 4px;
        }

        .options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 6px;
        }

        .option-btn {
            padding: 6px 11px;
            border-radius: 999px;
            border: 1px solid rgba(255,255,255,0.45);
            background: rgba(104, 26, 26, 0.9);
            color: #fff;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.15s ease, transform 0.05s ease;
        }

        .option-btn:hover {
            background: rgba(73, 115, 189, 0.95);
        }

        .option-btn:active {
            transform: translateY(1px);
        }

        /* Snowflakes */
        .snowflake {
            position: fixed;
            top: -10px;
            color: #fff;
            opacity: 0.85;
            font-size: 16px;
            pointer-events: none;
            animation-name: fall;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
            z-index: 0;
        }

        @keyframes fall {
            0% { transform: translateY(-10vh); }
            100% { transform: translateY(110vh); }
        }

        .garland {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 40px;
            pointer-events: none;
            display: flex;
            justify-content: center;
            gap: 10px;
            font-size: 22px;
            z-index: 1;
            text-shadow: 0 0 8px rgba(0,0,0,0.7);
        }

        .trees {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 42px;
            display: flex;
            justify-content: center;
            gap: 8px;
            font-size: 32px;
            pointer-events: none;
            text-shadow: 0 0 6px rgba(0,0,0,0.8);
            z-index: 1;
        }

        .content-wrapper {
            position: relative;
            z-index: 2;
            padding-bottom: 60px;
        }

        /* Match game */
        .match-container {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .match-column {
            flex: 1 1 200px;
        }

        .match-column h3 {
            margin: 0 0 6px;
            font-size: 16px;
        }

        .match-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .match-btn {
            padding: 6px 10px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.45);
            background: rgba(104,26,26,0.9);
            color: #fff;
            cursor: pointer;
            font-size: 13px;
            text-align: left;
            transition: background 0.15s ease, transform 0.05s ease, border-color 0.15s ease, opacity 0.15s ease;
        }

        .match-btn:hover {
            background: rgba(189,73,73,0.95);
        }

        .match-btn.selected {
            border-color: #ffe082;
            background: rgba(255,212,79,0.9);
            color: #1b243b;
        }

        .match-btn.matched {
            background: rgba(40,120,40,0.85);
            border-color: rgba(200,255,200,0.8);
            opacity: 0.8;
            cursor: default;
        }

        /* Crossword grid */
        #cross-grid {
            margin-top: 12px;
            display: inline-block;
            border: 2px solid rgba(255,255,255,0.4);
            border-radius: 8px;
            padding: 6px;
            background: rgba(40,8,8,0.9);
        }

        .cross-row {
            display: flex;
        }

        .cross-cell {
            width: 28px;
            height: 28px;
            margin: 1px;
            box-sizing: border-box;
        }

        .cross-cell input {
            width: 100%;
            height: 100%;
            text-align: center;
            font-size: 18px;
            border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.6);
            background: rgba(122,18,18,0.9);
            color: #fff;
        }

        .cross-block {
            width: 28px;
            height: 28px;
            margin: 1px;
            background: rgba(25,4,4,0.9);
            border-radius: 4px;
        }

        .cross-number {
            position: relative;
        }

        .cross-number span {
            position: absolute;
            top: 1px;
            left: 2px;
            font-size: 9px;
            color: #ffeb3b;
        }

        #cross-controls-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        /* Letter palette */
        #cross-palette {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .palette-btn {
            padding: 4px 7px;
            border-radius: 6px;
            border: 1px solid rgba(255,255,255,0.5);
            background: rgba(104,26,26,0.95);
            color: #fff;
            font-size: 13px;
            cursor: pointer;
            min-width: 22px;
            text-align: center;
        }

        .palette-btn:hover {
            background: rgba(189,73,73,0.95);
        }

        /* Clues */
        #cross-clues {
            margin-top: 10px;
            font-size: 13px;
            display: flex;
            flex-wrap: wrap;
            gap: 24px;
        }

        .clue-column-title {
            font-weight: 700;
            margin-bottom: 4px;
        }

        .clue-item {
            margin-bottom: 3px;
        }

        /* Build-word game */
        #buildword-target {
            letter-spacing: 6px;
            min-height: 30px;
        }

        .build-slot {
            display: inline-block;
            font-size: 26px;
            font-weight: 700;
            min-width: 20px;
        }

        /* Fireworks */
        .fw {
            position: fixed;
            font-size: 24px;
            pointer-events: none;
            animation: fw-burst 1s ease-out forwards;
            z-index: 999;
        }

        @keyframes fw-burst {
            0% {
                transform: translateY(0) scale(0.3);
                opacity: 1;
            }
            100% {
                transform: translateY(-80px) scale(1.4);
                opacity: 0;
            }
        }
    </style>
</head>
<body>

<div class="garland">
    üéÑ‚ú®‚≠êÔ∏è‚ú®üéÑ‚ú®‚≠êÔ∏è‚ú®üéÑ
</div>

<div class="trees">
    üéÑüéÑüéÑüéÑüéÑüéÑüéÑüéÑüéÑ
</div>

<div class="content-wrapper">
    <h1>Nancy Drew English Trainer üéÑ</h1>

    <!-- FLASHCARDS -->
    <div class="section">
        <h2>–ö–∞—Ä—Ç–∫–∏ (flashcards)</h2>
        <div class="controls">
            <button id="f-prev">‚óÄ –ü–æ–ø–µ—Ä–µ–¥–Ω—î</button>
            <button id="f-next">–ù–∞—Å—Ç—É–ø–Ω–µ ‚ñ∂</button>
            <button id="f-rand">üé≤ –í–∏–ø–∞–¥–∫–æ–≤–µ</button>
            <button id="f-toggle">–ü–æ–∫–∞–∑–∞—Ç–∏ / —Å—Ö–æ–≤–∞—Ç–∏ –ø–µ—Ä–µ–∫–ª–∞–¥</button>
        </div>
        <div class="flashcard">
            <div id="f-en" class="flash-main"></div>
            <div id="f-uaTr" class="flash-extra"></div>
            <div id="f-ua" class="flash-extra"></div>
        </div>
        <div class="small-note">
            –°–ø–æ—á–∞—Ç–∫—É —á–∏—Ç–∞—î –∞–Ω–≥–ª—ñ–π—Å—å–∫–µ —Å–ª–æ–≤–æ –π –≤–∏–º–æ–≤—É, –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –∑–≥–∞–¥–∞—Ç–∏ –ø–µ—Ä–µ–∫–ª–∞–¥, –ø–æ—Ç—ñ–º –Ω–∞—Ç–∏—Å–∫–∞—î –∫–Ω–æ–ø–∫—É.
        </div>
    </div>

    <!-- QUIZ 1: EN -> UA -->
    <div class="section">
        <h2>–¢–µ—Å—Ç 1: –ø–µ—Ä–µ–∫–ª–∞–¥ –∑ –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—ó –Ω–∞ —É–∫—Ä–∞—ó–Ω—Å—å–∫—É</h2>
        <div class="quiz-block">
            <div id="q1-question" class="quiz-question"></div>
            <div id="q1-sub" class="quiz-sub"></div>
            <div id="q1-options" class="options"></div>
            <div class="controls">
                <button id="q1-new">–ù–æ–≤–µ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è</button>
            </div>
            <div id="q1-result" class="quiz-result"></div>
        </div>
    </div>

    <!-- QUIZ 2: UA -> EN -->
    <div class="section">
        <h2>–¢–µ—Å—Ç 2: –ø–µ—Ä–µ–∫–ª–∞–¥ –∑ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—ó –Ω–∞ –∞–Ω–≥–ª—ñ–π—Å—å–∫—É</h2>
        <div class="quiz-block">
            <div id="q2-question" class="quiz-question"></div>
            <div id="q2-sub" class="quiz-sub"></div>
            <div id="q2-options" class="options"></div>
            <div class="controls">
                <button id="q2-new">–ù–æ–≤–µ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è</button>
            </div>
            <div id="q2-result" class="quiz-result"></div>
        </div>
    </div>

    <!-- QUIZ 3: TRUE/FALSE PAIRS -->
    <div class="section">
        <h2>–¢–µ—Å—Ç 3: –ø—Ä–∞–≤–∏–ª—å–Ω–æ —á–∏ –Ω—ñ?</h2>
        <div class="small-note">
            –ß–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ—î–¥–Ω–∞–Ω—ñ —Å–ª–æ–≤–æ –π –ø–µ—Ä–µ–∫–ª–∞–¥? –û–±–µ—Ä–∏ ¬´–¢–∞–∫, –ø—Ä–∞–≤–∏–ª—å–Ω–æ¬ª –∞–±–æ ¬´–ù—ñ, –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ¬ª.
        </div>
        <div class="quiz-block">
            <div id="q3-question" class="quiz-question"></div>
            <div id="q3-sub" class="quiz-sub"></div>
            <div class="controls">
                <button id="q3-yes">–¢–∞–∫, –ø—Ä–∞–≤–∏–ª—å–Ω–æ</button>
                <button id="q3-no">–ù—ñ, –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ</button>
                <button id="q3-new">–ù–æ–≤–µ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è</button>
            </div>
            <div id="q3-result" class="quiz-result"></div>
        </div>
    </div>

    <!-- MATCH GAME -->
    <div class="section">
        <h2>–ì—Ä–∞: –∑–Ω–∞–π–¥–∏ –ø–∞—Ä—É (–∞–Ω–≥–ª—ñ–π—Å—å–∫–∞ ‚Üî —É–∫—Ä–∞—ó–Ω—Å—å–∫–∞)</h2>
        <div class="small-note">
            –ù–∞—Ç–∏—Å–Ω–∏ –∞–Ω–≥–ª—ñ–π—Å—å–∫–µ —Å–ª–æ–≤–æ, –ø–æ—Ç—ñ–º –π–æ–≥–æ –ø–µ—Ä–µ–∫–ª–∞–¥ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é. –ó–±–µ—Ä–∏ –≤—Å—ñ –ø–∞—Ä–∏.
        </div>
        <div class="match-container">
            <div class="match-column">
                <h3>English</h3>
                <div id="match-en" class="match-list"></div>
            </div>
            <div class="match-column">
                <h3>–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</h3>
                <div id="match-ua" class="match-list"></div>
            </div>
        </div>
        <div class="controls">
            <button id="match-new">–ù–æ–≤–∞ –≥—Ä–∞</button>
        </div>
        <div id="match-result" class="quiz-result"></div>
    </div>

    <!-- BUILD WORD GAME -->
    <div class="section">
        <h2>–ì—Ä–∞: —Å–∫–ª–∞–¥–∏ –∞–Ω–≥–ª—ñ–π—Å—å–∫–µ —Å–ª–æ–≤–æ –∑ –±—É–∫–≤</h2>
        <div class="small-note">
            –ü–æ–¥–∏–≤–∏—Å—å –Ω–∞ –ø–µ—Ä–µ–∫–ª–∞–¥ —ñ –≤–∏–º–æ–≤—É. –ù–∞—Ç–∏—Å–∫–∞–π –Ω–∞ –±—É–∫–≤–∏, —â–æ–± —Å–∫–ª–∞—Å—Ç–∏ –∞–Ω–≥–ª—ñ–π—Å—å–∫–µ —Å–ª–æ–≤–æ.
            –Ø–∫—â–æ –≤—Å–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚Äî –±—É–¥–µ —Ñ–µ—î—Ä–≤–µ—Ä–∫ üéÜ
        </div>

        <div id="buildword-hint" class="quiz-sub"></div>
        <div id="buildword-target" class="quiz-question"></div>
        <div id="buildword-letters" class="options"></div>

        <div class="controls">
            <button id="buildword-clear">–û—á–∏—Å—Ç–∏—Ç–∏</button>
            <button id="buildword-new">–ù–æ–≤–µ —Å–ª–æ–≤–æ</button>
        </div>

        <div id="buildword-result" class="quiz-result"></div>
    </div>

    <!-- BIG CROSSWORD -->
    <div class="section">
        <h2>–í–µ–ª–∏–∫–∏–π –∫—Ä–æ—Å–≤–æ—Ä–¥</h2>
        <div class="small-note">
            –£ –∫—Ä–æ—Å–≤–æ—Ä–¥—ñ —î —Å–ª–æ–≤–∞ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—ñ –π –≤–µ—Ä—Ç–∏–∫–∞–ª—ñ. –ö–ª—ñ–∫–∞–π –Ω–∞ –∫–ª—ñ—Ç–∏–Ω–∫—É, –ø–æ—Ç—ñ–º –Ω–∞ –±—É–∫–≤—É –≤ –ø–∞–ª—ñ—Ç—Ä—ñ
            –∞–±–æ –Ω–∞–±–∏—Ä–∞–π –Ω–∞ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä—ñ.
        </div>

        <div id="cross-grid"></div>

        <div id="cross-controls-row">
            <button id="cross-new">–ù–æ–≤–∏–π –∫—Ä–æ—Å–≤–æ—Ä–¥</button>
            <button id="cross-check">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
            <button id="cross-show">–ü–æ–∫–∞–∑–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ</button>
        </div>

        <div class="small-note">
            –ü–∞–ª—ñ—Ç—Ä–∞ –±—É–∫–≤:
        </div>
        <div id="cross-palette"></div>

        <div id="cross-clues"></div>

        <div id="cross-result" class="quiz-result"></div>
    </div>
</div>

<script>
    // ===== STATS =====
    const stats = {
        startedAt: Date.now(),
        correct: 0,
        incorrect: 0,
    };

    function registerCorrect() {
        stats.correct++;
    }

    function registerIncorrect() {
        stats.incorrect++;
    }

    function sendStatsToParent() {
        const payload = {
            type: "taskResult",
            correct: stats.correct,
            incorrect: stats.incorrect,
            timeMs: Date.now() - stats.startedAt,
        };

        // Send result to parent React app (TaskPage)
        if (window.parent && window.parent !== window) {
            window.parent.postMessage(payload, "*");
        }
    }

    // Optional: call manually from a "Finish" button if –∑–∞—Ö–æ—á–µ—à
    // window.sendStatsToParent = sendStatsToParent;

    // When user closes page / –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –¥–∞–ª—ñ ‚Äî –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ
    window.addEventListener("beforeunload", sendStatsToParent);

    // ===== WORD LIST (–∫–æ—Ä–æ—Ç–∫–∞—è Nancy Drew-–≤–µ—Ä—Å–∏—è) =====
    const words = [
        {en: "dream", uaTr: "–¥—Ä—ñ–º", ua: "—Å–æ–Ω / –º—Ä—ñ—è"},
        {en: "pet", uaTr: "–ø–µ—Ç", ua: "–¥–æ–º–∞—à–Ω—ñ–π —É–ª—é–±–ª–µ–Ω–µ—Ü—å"},
        {en: "together", uaTr: "—Ç–µ“ë√©–∑–µ—Ä", ua: "—Ä–∞–∑–æ–º"},
        {en: "sleeps over", uaTr: "—Å–ª—ñ–ø—Å √≥—É–≤–µ—Ä", ua: "–∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –Ω–æ—á—É–≤–∞—Ç–∏"},
        {en: "called", uaTr: "–∫–æ–ª–¥", ua: "–ø–æ–¥–∑–≤–æ–Ω–∏–ª–∞ / –Ω–∞–∑–≤–∞–ª–∞"},
        {en: "emergency", uaTr: "—ñ–º√©—Ä–¥–∂–µ–Ω—Å—ñ", ua: "—Ç–µ—Ä–º—ñ–Ω–æ–≤–æ, –Ω–µ–≤—ñ–¥–∫–ª–∞–¥–Ω–∏–π –≤–∏–ø–∞–¥–æ–∫"},
        {en: "right away", uaTr: "—Ä–∞–π—Ç –µ–≤√©–π", ua: "–Ω–µ–≥–∞–π–Ω–æ"},
        {en: "hill", uaTr: "—Ö—ñ–ª", ua: "–ø–∞–≥–æ—Ä–±"},
        {en: "as fast as I could", uaTr: "–µ–∑ —Ñ–∞—Å—Ç –µ–∑ –∞–π –∫—É–¥", ua: "—Ç–∞–∫ —à–≤–∏–¥–∫–æ, —è–∫ –º–æ–≥–ª–∞"},
        {en: "rose", uaTr: "—Ä–æ—É–∑", ua: "–ø—ñ–¥–Ω—è–≤—Å—è / –ø—ñ–¥–≤–µ–ª–∞—Å—è"},
        {en: "followed", uaTr: "—Ñ√≥–ª–æ—É–¥", ua: "—Å–ª—ñ–¥—É–≤–∞–ª–∏ –∑–∞"},
        {en: "as", uaTr: "–µ–∑", ua: "—è–∫"},
        {en: "full", uaTr: "—Ñ—É–ª", ua: "–ø–æ–≤–Ω–∏–π"},
        {en: "piggy bank", uaTr: "–ø√≠“ë—ñ –±–µ–Ω–∫", ua: "—Å–∫–∞—Ä–±–Ω–∏—á–∫–∞ —É –≤–∏–≥–ª—è–¥—ñ —Å–≤–∏–Ω–∫–∏"},
        {en: "even", uaTr: "√≠–≤–µ–Ω", ua: "–Ω–∞–≤—ñ—Ç—å"},
        {en: "fuzzy", uaTr: "—Ñ√°–∑—ñ", ua: "–ø—É—Ö–Ω–∞—Å—Ç–∏–π, —Ä–æ–∑–º–∏—Ç–∏–π"}
    ];

    // ===== SNOW =====
    for (let i = 0; i < 30; i++) {
        const span = document.createElement("span");
        span.className = "snowflake";
        span.textContent = "‚ùÑ";
        const duration = 10 + Math.random() * 10;
        const delay = Math.random() * -duration;
        const left = Math.random() * 100;
        span.style.left = left + "vw";
        span.style.animationDuration = duration + "s";
        span.style.animationDelay = delay + "s";
        document.body.appendChild(span);
    }

    // ===== FLASHCARDS =====
    let fIndex = 0;
    let showTranslation = true;
    const fEn = document.getElementById("f-en");
    const fUaTr = document.getElementById("f-uaTr");
    const fUa = document.getElementById("f-ua");

    function updateFlashcard() {
        const w = words[fIndex];
        fEn.textContent = w.en;
        fUaTr.textContent = "–í–∏–º–æ–≤–∞: " + w.uaTr;
        fUa.textContent = "–ü–µ—Ä–µ–∫–ª–∞–¥: " + w.ua;
        const disp = showTranslation ? "block" : "none";
        fUaTr.style.display = disp;
        fUa.style.display = disp;
    }

    document.getElementById("f-prev").onclick = () => {
        fIndex = (fIndex - 1 + words.length) % words.length;
        updateFlashcard();
    };
    document.getElementById("f-next").onclick = () => {
        fIndex = (fIndex + 1) % words.length;
        updateFlashcard();
    };
    document.getElementById("f-rand").onclick = () => {
        fIndex = Math.floor(Math.random() * words.length);
        updateFlashcard();
    };
    document.getElementById("f-toggle").onclick = () => {
        showTranslation = !showTranslation;
        updateFlashcard();
    };

    // ===== HELPER: SHUFFLE =====
    function shuffle(arr) {
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
    }

    // ===== QUIZ 1: EN -> UA =====
    const q1Question = document.getElementById("q1-question");
    const q1Sub = document.getElementById("q1-sub");
    const q1Options = document.getElementById("q1-options");
    const q1Result = document.getElementById("q1-result");
    let q1Correct = "";

    function newQ1() {
        const idx = Math.floor(Math.random() * words.length);
        const w = words[idx];
        q1Correct = w.ua;
        q1Question.textContent = "–ê–Ω–≥–ª—ñ–π—Å—å–∫–µ —Å–ª–æ–≤–æ: " + w.en;
        q1Sub.textContent = "–í–∏–º–æ–≤–∞: " + w.uaTr + " ‚Äî –≤–∏–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø–µ—Ä–µ–∫–ª–∞–¥ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é:";
        q1Options.innerHTML = "";
        q1Result.textContent = "";
        q1Result.className = "quiz-result";

        const opts = new Set();
        opts.add(w.ua);
        while (opts.size < 4 && opts.size < words.length) {
            const w2 = words[Math.floor(Math.random() * words.length)];
            opts.add(w2.ua);
        }

        shuffle(Array.from(opts)).forEach(opt => {
            const btn = document.createElement("button");
            btn.textContent = opt;
            btn.className = "option-btn";
            btn.onclick = () => {
                if (opt === q1Correct) {
                    q1Result.textContent = "–ü—Ä–∞–≤–∏–ª—å–Ω–æ! ‚úî";
                    q1Result.className = "quiz-result correct";
                    registerCorrect();
                } else {
                    q1Result.textContent = "–ù–µ —Ç–µ. –ü—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å: " + q1Correct;
                    q1Result.className = "quiz-result incorrect";
                    registerIncorrect();
                }
            };
            q1Options.appendChild(btn);
        });
    }
    document.getElementById("q1-new").onclick = newQ1;

    // ===== QUIZ 2: UA -> EN =====
    const q2Question = document.getElementById("q2-question");
    const q2Sub = document.getElementById("q2-sub");
    const q2Options = document.getElementById("q2-options");
    const q2Result = document.getElementById("q2-result");
    let q2Correct = "";

    function newQ2() {
        const idx = Math.floor(Math.random() * words.length);
        const w = words[idx];
        q2Correct = w.en;
        q2Question.textContent = "–£–∫—Ä–∞—ó–Ω—Å—å–∫–µ —Å–ª–æ–≤–æ: " + w.ua;
        q2Sub.textContent = "–í–∏–º–æ–≤–∞ –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ–≥–æ —Å–ª–æ–≤–∞: " + w.uaTr + " ‚Äî –≤–∏–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–µ –∞–Ω–≥–ª—ñ–π—Å—å–∫–µ —Å–ª–æ–≤–æ:";
        q2Options.innerHTML = "";
        q2Result.textContent = "";
        q2Result.className = "quiz-result";

        const opts = new Set();
        opts.add(w.en);
        while (opts.size < 4 && opts.size < words.length) {
            const w2 = words[Math.floor(Math.random() * words.length)];
            opts.add(w2.en);
        }

        shuffle(Array.from(opts)).forEach(opt => {
            const btn = document.createElement("button");
            btn.textContent = opt;
            btn.className = "option-btn";
            btn.onclick = () => {
                if (opt === q2Correct) {
                    q2Result.textContent = "–°—É–ø–µ—Ä! ‚úî";
                    q2Result.className = "quiz-result correct";
                    registerCorrect();
                } else {
                    q2Result.textContent = "–ù–µ —Ç–µ. –ü—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å: " + q2Correct;
                    q2Result.className = "quiz-result incorrect";
                    registerIncorrect();
                }
            };
            q2Options.appendChild(btn);
        });
    }
    document.getElementById("q2-new").onclick = newQ2;

    // ===== QUIZ 3: TRUE/FALSE =====
    const q3Question = document.getElementById("q3-question");
    const q3Sub = document.getElementById("q3-sub");
    const q3Result = document.getElementById("q3-result");
    let q3IsCorrectPair = true;

    function newQ3() {
        const idx = Math.floor(Math.random() * words.length);
        const w = words[idx];

        const makeCorrect = Math.random() < 0.5;
        let shownUa;
        if (makeCorrect) {
            shownUa = w.ua;
            q3IsCorrectPair = true;
        } else {
            let otherIdx;
            do {
                otherIdx = Math.floor(Math.random() * words.length);
            } while (otherIdx === idx);
            shownUa = words[otherIdx].ua;
            q3IsCorrectPair = false;
        }

        q3Question.textContent = w.en + " ‚Äî " + shownUa;
        q3Sub.textContent = "–ß–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ—î–¥–Ω–∞–Ω—ñ —Å–ª–æ–≤–æ –π –ø–µ—Ä–µ–∫–ª–∞–¥?";
        q3Result.textContent = "";
        q3Result.className = "quiz-result";
    }

    function answerQ3(userSaysCorrect) {
        const ok = (userSaysCorrect === q3IsCorrectPair);
        if (ok) {
            q3Result.textContent = "–¢–∞–∫! –¶–µ –ø—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å ‚úî";
            q3Result.className = "quiz-result correct";
            registerCorrect();
        } else {
            q3Result.textContent = "–ù–µ –∑–æ–≤—Å—ñ–º. –°–ø—Ä–æ–±—É–π —ñ–Ω—à–µ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è üôÇ";
            q3Result.className = "quiz-result incorrect";
            registerIncorrect();
        }
    }

    document.getElementById("q3-yes").onclick = () => answerQ3(true);
    document.getElementById("q3-no").onclick = () => answerQ3(false);
    document.getElementById("q3-new").onclick = newQ3;

    // ===== MATCH GAME =====
    const matchEn = document.getElementById("match-en");
    const matchUa = document.getElementById("match-ua");
    const matchResult = document.getElementById("match-result");
    let matchPairs = [];
    let selectedEnBtn = null;
    let selectedUaBtn = null;

    function newMatchGame() {
        matchEn.innerHTML = "";
        matchUa.innerHTML = "";
        matchResult.textContent = "";
        matchResult.className = "quiz-result";

        const used = new Set();
        while (used.size < 6 && used.size < words.length) {
            used.add(Math.floor(Math.random() * words.length));
        }
        matchPairs = Array.from(used).map(i => ({
            index: i,
            en: words[i].en,
            ua: words[i].ua
        }));

        const enOrder = shuffle([...matchPairs]);
        const uaOrder = shuffle([...matchPairs]);

        selectedEnBtn = null;
        selectedUaBtn = null;

        enOrder.forEach(p => {
            const btn = document.createElement("button");
            btn.textContent = p.en;
            btn.className = "match-btn";
            btn.dataset.id = String(p.index);
            btn.dataset.lang = "en";
            btn.onclick = () => onMatchClick(btn);
            matchEn.appendChild(btn);
        });

        uaOrder.forEach(p => {
            const btn = document.createElement("button");
            btn.textContent = p.ua;
            btn.className = "match-btn";
            btn.dataset.id = String(p.index);
            btn.dataset.lang = "ua";
            btn.onclick = () => onMatchClick(btn);
            matchUa.appendChild(btn);
        });
    }

    function onMatchClick(btn) {
        if (btn.classList.contains("matched")) return;
        const lang = btn.dataset.lang;
        if (lang === "en") {
            if (selectedEnBtn && selectedEnBtn !== btn) {
                selectedEnBtn.classList.remove("selected");
            }
            selectedEnBtn = btn;
            btn.classList.toggle("selected");
            if (!btn.classList.contains("selected")) {
                selectedEnBtn = null;
            }
        } else {
            if (selectedUaBtn && selectedUaBtn !== btn) {
                selectedUaBtn.classList.remove("selected");
            }
            selectedUaBtn = btn;
            btn.classList.toggle("selected");
            if (!btn.classList.contains("selected")) {
                selectedUaBtn = null;
            }
        }

        if (selectedEnBtn && selectedUaBtn) {
            checkMatchPair();
        }
    }

    function checkMatchPair() {
        const idEn = selectedEnBtn.dataset.id;
        const idUa = selectedUaBtn.dataset.id;

        if (idEn === idUa) {
            selectedEnBtn.classList.remove("selected");
            selectedUaBtn.classList.remove("selected");
            selectedEnBtn.classList.add("matched");
            selectedUaBtn.classList.add("matched");
            selectedEnBtn = null;
            selectedUaBtn = null;

            registerCorrect();

            const remaining = document.querySelectorAll(".match-btn:not(.matched)");
            if (remaining.length === 0) {
                matchResult.textContent = "–£—Ä–∞! –£—Å—ñ –ø–∞—Ä–∏ –∑–Ω–∞–π–¥–µ–Ω–æ! üéÑ";
                matchResult.className = "quiz-result correct";
            } else {
                matchResult.textContent = "–Ñ –∑–±—ñ–≥! –ü—Ä–æ–¥–æ–≤–∂—É–π üôÇ";
                matchResult.className = "quiz-result correct";
            }
        } else {
            matchResult.textContent = "–ù–µ —Ç–∞ –ø–∞—Ä–∞. –°–ø—Ä–æ–±—É–π —â–µ.";
            matchResult.className = "quiz-result incorrect";
            registerIncorrect();
            const enBtn = selectedEnBtn;
            const uaBtn = selectedUaBtn;
            setTimeout(() => {
                enBtn.classList.remove("selected");
                uaBtn.classList.remove("selected");
                if (selectedEnBtn === enBtn) selectedEnBtn = null;
                if (selectedUaBtn === uaBtn) selectedUaBtn = null;
            }, 400);
        }
    }

    document.getElementById("match-new").onclick = newMatchGame;

    // ===== BUILD WORD GAME =====
    const buildHint = document.getElementById("buildword-hint");
    const buildTarget = document.getElementById("buildword-target");
    const buildLetters = document.getElementById("buildword-letters");
    const buildResult = document.getElementById("buildword-result");
    const buildClearBtn = document.getElementById("buildword-clear");
    const buildNewBtn = document.getElementById("buildword-new");

    // Only simple one-word entries (letters only, length 3‚Äì12)
    const buildWordsPool = words.filter(w =>
        /^[a-zA-Z ]+$/.test(w.en) &&
        w.en.replace(/ /g, "").length >= 3 &&
        w.en.replace(/ /g, "").length <= 12
    );

    let buildCurrentWord = null;
    let buildCurrentAnswer = "";

    function launchFireworks() {
        for (let i = 0; i < 18; i++) {
            const span = document.createElement("span");
            span.className = "fw";
            span.textContent = "üéÜ";

            const left = 10 + Math.random() * 80;
            const top = 40 + Math.random() * 30;

            span.style.left = left + "vw";
            span.style.top = top + "vh";

            document.body.appendChild(span);

            setTimeout(() => {
                span.remove();
            }, 1000);
        }
    }

    function renderBuildSlots() {
        if (!buildCurrentWord) return;
        const target = buildCurrentWord.replace(/ /g, "");
        const len = target.length;
        const filled = buildCurrentAnswer.toUpperCase();
        let html = "";

        for (let i = 0; i < len; i++) {
            const ch = filled[i] || "_";
            html += `<span class="build-slot">${ch}</span>`;
        }

        buildTarget.innerHTML = html;
    }

    function clearBuildWord() {
        buildCurrentAnswer = "";
        buildResult.textContent = "";
        buildResult.className = "quiz-result";
        renderBuildSlots();

        const buttons = buildLetters.querySelectorAll("button");
        buttons.forEach(btn => {
            btn.disabled = false;
            btn.style.opacity = "1";
        });
    }

    function newBuildWordRound() {
        clearBuildWord();
        if (buildWordsPool.length === 0) return;

        const idx = Math.floor(Math.random() * buildWordsPool.length);
        const w = buildWordsPool[idx];

        buildCurrentWord = w.en.toUpperCase();
        buildCurrentAnswer = "";

        buildHint.textContent = `–ü–µ—Ä–µ–∫–ª–∞–¥: ${w.ua} | –í–∏–º–æ–≤–∞: ${w.uaTr}`;
        buildResult.textContent = "";
        buildResult.className = "quiz-result";

        renderBuildSlots();

        buildLetters.innerHTML = "";
        const target = buildCurrentWord.replace(/ /g, "");
        const letters = target.split("");
        shuffle(letters);

        letters.forEach((ch, index) => {
            const btn = document.createElement("button");
            btn.className = "option-btn";
            btn.textContent = ch;
            btn.dataset.letterIndex = String(index);

            btn.onclick = () => {
                if (btn.disabled) return;

                buildCurrentAnswer += ch;
                btn.disabled = true;
                btn.style.opacity = "0.4";

                renderBuildSlots();

                if (buildCurrentAnswer.length === target.length) {
                    if (buildCurrentAnswer.toUpperCase() === target) {
                        buildResult.textContent = "–ß—É–¥–æ–≤–æ! –°–ª–æ–≤–æ —Å–∫–ª–∞–¥–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ! üéâ";
                        buildResult.className = "quiz-result correct";
                        registerCorrect();
                        launchFireworks();
                    } else {
                        buildResult.textContent = `–ù–µ –∑–æ–≤—Å—ñ–º. –ü—Ä–∞–≤–∏–ª—å–Ω–µ —Å–ª–æ–≤–æ: ${buildCurrentWord}`;
                        buildResult.className = "quiz-result incorrect";
                        registerIncorrect();
                    }
                }
            };

            buildLetters.appendChild(btn);
        });
    }

    buildClearBtn.onclick = clearBuildWord;
    buildNewBtn.onclick = newBuildWordRound;

    // ===== BIG CROSSWORD =====
    const GRID_SIZE = 12;
    const MAX_WORDS_IN_CROSS = 15;

    let crossSolution = [];
    let crossNumbers = [];
    let crossWordsPlaced = [];
    let activeCell = null;

    const crossGridDiv = document.getElementById("cross-grid");
    const crossPaletteDiv = document.getElementById("cross-palette");
    const crossCluesDiv = document.getElementById("cross-clues");
    const crossResult = document.getElementById("cross-result");

    function createEmptyGrid() {
        const grid = [];
        for (let r = 0; r < GRID_SIZE; r++) {
            const row = [];
            for (let c = 0; c < GRID_SIZE; c++) {
                row.push(null);
            }
            grid.push(row);
        }
        return grid;
    }

    function shuffleIndices(n) {
        const arr = [];
        for (let i = 0; i < n; i++) arr.push(i);
        return shuffle(arr);
    }

    function canPlaceWord(grid, word, row, col, dir) {
        const len = word.length;
        if (dir === "across") {
            if (col + len > GRID_SIZE) return false;
        } else {
            if (row + len > GRID_SIZE) return false;
        }

        for (let i = 0; i < len; i++) {
            const r = row + (dir === "down" ? i : 0);
            const c = col + (dir === "across" ? i : 0);
            const cell = grid[r][c];
            if (cell !== null && cell !== word[i]) {
                return false;
            }
        }
        return true;
    }

    function placeWordOnGrid(grid, word, row, col, dir) {
        for (let i = 0; i < word.length; i++) {
            const r = row + (dir === "down" ? i : 0);
            const c = col + (dir === "across" ? i : 0);
            grid[r][c] = word[i];
        }
    }

    function generateCrosswordData() {
        let grid = createEmptyGrid();
        let placed = [];

        const indices = shuffleIndices(words.length);
        let wordCount = 0;

        for (let idx of indices) {
            const entry = words[idx];
            let word = entry.en.toUpperCase().replace(/[^A-Z]/g, "");
            if (word.length < 3 || word.length > GRID_SIZE) continue;

            let placedThis = false;
            for (let attempt = 0; attempt < 60 && !placedThis; attempt++) {
                const dir = Math.random() < 0.5 ? "across" : "down";
                const row = Math.floor(Math.random() * GRID_SIZE);
                const col = Math.floor(Math.random() * GRID_SIZE);

                if (canPlaceWord(grid, word, row, col, dir)) {
                    placeWordOnGrid(grid, word, row, col, dir);
                    placed.push({
                        answer: word,
                        clueUa: entry.ua,
                        dir: dir,
                        row: row,
                        col: col
                    });
                    placedThis = true;
                    wordCount++;
                    if (wordCount >= MAX_WORDS_IN_CROSS) break;
                }
            }
            if (wordCount >= MAX_WORDS_IN_CROSS) break;
        }

        return { grid, placed };
    }

    function numberCrosswordWords(grid, placed) {
        const numbers = Array.from({ length: GRID_SIZE }, () =>
            Array(GRID_SIZE).fill(null)
        );

        let currentNumber = 1;
        placed.forEach(p => {
            const r = p.row;
            const c = p.col;
            if (p.dir === "across") {
                const start = (c === 0 || grid[r][c - 1] === null);
                if (start) {
                    p.num = currentNumber;
                    numbers[r][c] = currentNumber;
                    currentNumber++;
                }
            } else {
                const start = (r === 0 || grid[r - 1][c] === null);
                if (start) {
                    p.num = currentNumber;
                    numbers[r][c] = currentNumber;
                    currentNumber++;
                }
            }
        });

        return numbers;
    }

    function buildCrosswordDOM() {
        crossGridDiv.innerHTML = "";
        crossCluesDiv.innerHTML = "";
        crossResult.textContent = "";
        crossResult.className = "quiz-result";

        const grid = crossSolution;
        const numbers = crossNumbers;

        for (let r = 0; r < GRID_SIZE; r++) {
            const rowDiv = document.createElement("div");
            rowDiv.className = "cross-row";

            for (let c = 0; c < GRID_SIZE; c++) {
                const letter = grid[r][c];
                if (letter === null) {
                    const block = document.createElement("div");
                    block.className = "cross-block";
                    rowDiv.appendChild(block);
                } else {
                    const wrapper = document.createElement("div");
                    wrapper.className = "cross-cell cross-number";

                    const input = document.createElement("input");
                    input.type = "text";
                    input.maxLength = 1;
                    input.dataset.row = String(r);
                    input.dataset.col = String(c);

                    input.oninput = () => {
                        input.value = input.value.toUpperCase().replace(/[^A-Z]/g, "");
                    };
                    input.onclick = () => {
                        activeCell = input;
                    };
                    input.onfocus = () => {
                        activeCell = input;
                    };

                    wrapper.appendChild(input);

                    const num = numbers[r][c];
                    if (num !== null) {
                        const numSpan = document.createElement("span");
                        numSpan.textContent = num;
                        wrapper.appendChild(numSpan);
                    }

                    rowDiv.appendChild(wrapper);
                }
            }

            crossGridDiv.appendChild(rowDiv);
        }

        const across = [];
        const down = [];

        crossWordsPlaced.forEach(p => {
            if (!p.num) return;
            const item = { num: p.num, clue: p.clueUa };
            if (p.dir === "across") across.push(item);
            else down.push(item);
        });

        across.sort((a, b) => a.num - b.num);
        down.sort((a, b) => a.num - b.num);

        const acrossDiv = document.createElement("div");
        const downDiv = document.createElement("div");

        const acrossTitle = document.createElement("div");
        acrossTitle.className = "clue-column-title";
        acrossTitle.textContent = "–ü–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—ñ";
        acrossDiv.appendChild(acrossTitle);

        across.forEach(cl => {
            const cd = document.createElement("div");
            cd.className = "clue-item";
            cd.textContent = cl.num + ". " + cl.clue;
            acrossDiv.appendChild(cd);
        });

        const downTitle = document.createElement("div");
        downTitle.className = "clue-column-title";
        downTitle.textContent = "–ü–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—ñ";
        downDiv.appendChild(downTitle);

        down.forEach(cl => {
            const cd = document.createElement("div");
            cd.className = "clue-item";
            cd.textContent = cl.num + ". " + cl.clue;
            downDiv.appendChild(cd);
        });

        crossCluesDiv.appendChild(acrossDiv);
        crossCluesDiv.appendChild(downDiv);
    }

    function buildPalette() {
        crossPaletteDiv.innerHTML = "";
        const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        for (let i = 0; i < letters.length; i++) {
            const ch = letters[i];
            const btn = document.createElement("button");
            btn.className = "palette-btn";
            btn.textContent = ch;
            btn.onclick = () => {
                if (activeCell) {
                    activeCell.value = ch;
                    const row = parseInt(activeCell.dataset.row, 10);
                    const col = parseInt(activeCell.dataset.col, 10);

                    let next = null;
                    for (let c = col + 1; c < GRID_SIZE; c++) {
                        const selector = 'input[data-row="' + row + '"][data-col="' + c + '"]';
                        const candidate = crossGridDiv.querySelector(selector);
                        if (candidate) {
                            next = candidate;
                            break;
                        }
                    }
                    if (next) {
                        next.focus();
                        activeCell = next;
                    }
                }
            };
            crossPaletteDiv.appendChild(btn);
        }
    }

    function checkCrossword() {
        let allFilled = true;
        let allCorrect = true;

        const inputs = crossGridDiv.querySelectorAll("input");
        inputs.forEach(input => {
            const r = parseInt(input.dataset.row, 10);
            const c = parseInt(input.dataset.col, 10);
            const correctLetter = crossSolution[r][c];
            const val = (input.value || "").toUpperCase();

            if (val === "") {
                allFilled = false;
            }

            if (val === correctLetter) {
                input.style.backgroundColor = "rgba(40, 120, 40, 0.85)";
            } else {
                input.style.backgroundColor = "rgba(140, 40, 40, 0.85)";
                allCorrect = false;
            }
        });

        if (allCorrect && allFilled) {
            crossResult.textContent = "–í–µ—Å—å –∫—Ä–æ—Å–≤–æ—Ä–¥ –∑–∞–ø–æ–≤–Ω–µ–Ω–∏–π –ø—Ä–∞–≤–∏–ª—å–Ω–æ! üéÑ‚ú®";
            crossResult.className = "quiz-result correct";
            registerCorrect();
        } else if (!allFilled) {
            crossResult.textContent = "–Ñ –ø–æ—Ä–æ–∂–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ –∞–±–æ –ø–æ–º–∏–ª–∫–∏. –°–ø—Ä–æ–±—É–π —â–µ.";
            crossResult.className = "quiz-result incorrect";
            registerIncorrect();
        } else {
            crossResult.textContent = "–Ñ –ø–æ–º–∏–ª–∫–∏. –ß–µ—Ä–≤–æ–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–ø—Ä–∞–≤–∏—Ç–∏.";
            crossResult.className = "quiz-result incorrect";
            registerIncorrect();
        }
    }

    function showCrossAnswers() {
        const inputs = crossGridDiv.querySelectorAll("input");
        inputs.forEach(input => {
            const r = parseInt(input.dataset.row, 10);
            const c = parseInt(input.dataset.col, 10);
            const correctLetter = crossSolution[r][c];
            input.value = correctLetter;
            input.style.backgroundColor = "rgba(40, 120, 40, 0.85)";
        });
        crossResult.textContent = "–í—ñ–¥–ø–æ–≤—ñ–¥—ñ –ø–æ–∫–∞–∑–∞–Ω—ñ.";
        crossResult.className = "quiz-result correct";
    }

    function newCrossword() {
        let data = generateCrosswordData();
        crossSolution = data.grid;
        crossWordsPlaced = data.placed;
        crossNumbers = numberCrosswordWords(crossSolution, crossWordsPlaced);
        buildCrosswordDOM();
        buildPalette();
    }

    document.getElementById("cross-new").onclick = newCrossword;
    document.getElementById("cross-check").onclick = checkCrossword;
    document.getElementById("cross-show").onclick = showCrossAnswers;

    // ===== INIT =====
    updateFlashcard();
    newQ1();
    newQ2();
    newQ3();
    newMatchGame();
    newBuildWordRound();
    newCrossword();
</script>
</body>
</html>

